<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>City Weather - Open-Meteo</title>
  <meta name="description" content="Simple Bootstrap page to fetch current temperature and humidity for a city using Open-Meteo.">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <style>
    body { background: #f8fafc; }
    .result-card { display: none; }
  </style>
</head>
<body>
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="card shadow-sm">
          <div class="card-header bg-primary text-white">
            <h1 class="h4 mb-0">Current Weather</h1>
          </div>
          <div class="card-body">
            <form class="mb-3" id="searchForm">
              <label for="cityInput" class="form-label">City name</label>
              <div class="input-group">
                <input type="text" id="cityInput" class="form-control" placeholder="e.g., London, Tokyo, New York" autocomplete="off" required>
                <button id="fetchBtn" type="submit" class="btn btn-primary">
                  Get Weather
                </button>
              </div>
            </form>

            <div id="alertBox" class="alert alert-danger d-none" role="alert"></div>

            <div id="resultCard" class="result-card">
              <h2 class="h5 mb-3" id="locationTitle"></h2>
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="p-3 border rounded bg-light">
                    <div class="text-muted small">Temperature</div>
                    <div class="fs-3 fw-semibold" id="tempValue">--</div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="p-3 border rounded bg-light">
                    <div class="text-muted small">Humidity</div>
                    <div class="fs-3 fw-semibold" id="humidityValue">--</div>
                  </div>
                </div>
              </div>
              <div class="mt-3 text-muted small" id="asOf"></div>
            </div>
          </div>
          <div class="card-footer bg-white text-muted small d-flex justify-content-between">
            <span>Powered by Open-Meteo and Open-Meteo Geocoding</span>
            <a class="text-decoration-none" href="https://open-meteo.com/" target="_blank" rel="noopener noreferrer">API Docs</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const cityInput = document.getElementById('cityInput');
    const fetchBtn = document.getElementById('fetchBtn');
    const searchForm = document.getElementById('searchForm');
    const alertBox = document.getElementById('alertBox');
    const resultCard = document.getElementById('resultCard');
    const locationTitle = document.getElementById('locationTitle');
    const tempValue = document.getElementById('tempValue');
    const humidityValue = document.getElementById('humidityValue');
    const asOf = document.getElementById('asOf');

    function showAlert(message) {
      alertBox.textContent = message;
      alertBox.classList.remove('d-none');
    }
    function clearAlert() {
      alertBox.classList.add('d-none');
      alertBox.textContent = '';
    }
    function setLoading(isLoading) {
      if (isLoading) {
        fetchBtn.disabled = true;
        fetchBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Fetching...';
      } else {
        fetchBtn.disabled = false;
        fetchBtn.textContent = 'Get Weather';
      }
    }
    function formatLocation(loc) {
      const parts = [loc.name, loc.admin1, loc.country].filter(Boolean);
      return parts.join(', ');
    }
    function renderResult(loc, data) {
      const current = data.current || {};
      const units = data.current_units || {};
      locationTitle.textContent = formatLocation(loc);
      tempValue.textContent = typeof current.temperature_2m === 'number'
        ? `${current.temperature_2m} ${units.temperature_2m || '°C'}`
        : '—';
      humidityValue.textContent = typeof current.relative_humidity_2m === 'number'
        ? `${current.relative_humidity_2m} ${units.relative_humidity_2m || '%'}`
        : '—';
      if (current.time) {
        const dt = new Date(current.time);
        asOf.textContent = `As of ${dt.toLocaleString()} (timezone: ${data.timezone || 'local'})`;
      } else {
        asOf.textContent = '';
      }
      resultCard.style.display = 'block';
    }

    async function geocodeCity(name) {
      const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(name)}&count=1&language=en&format=json`;
      const res = await fetch(url);
      if (!res.ok) throw new Error('Geocoding request failed.');
      const data = await res.json();
      if (!data.results || data.results.length === 0) return null;
      return data.results[0];
    }

    async function fetchWeather(lat, lon) {
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m&timezone=auto`;
      const res = await fetch(url);
      if (!res.ok) throw new Error('Weather request failed.');
      return res.json();
    }

    async function handleSearch(e) {
      e.preventDefault();
      clearAlert();
      resultCard.style.display = 'none';
      const city = cityInput.value.trim();
      if (!city) {
        showAlert('Please enter a city name.');
        return;
      }
      setLoading(true);
      try {
        const loc = await geocodeCity(city);
        if (!loc) {
          showAlert('City not found. Try another name or add country/region.');
          return;
        }
        const data = await fetchWeather(loc.latitude, loc.longitude);
        renderResult(loc, data);
      } catch (err) {
        console.error(err);
        showAlert('Something went wrong while fetching the weather. Please try again.');
      } finally {
        setLoading(false);
      }
    }

    searchForm.addEventListener('submit', handleSearch);
    // Optional: trigger on Enter in input (form submit already handles this)
    cityInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        // form submit handles
      }
    });
  </script>
</body>
</html>